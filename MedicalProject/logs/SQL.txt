select tt.sfzcode,max(tt.hzid),max(tt.hzname),max(tt.sex),max(tt.mz), tt.writedate, avg(tt.xuetang) from (
select t.id,t.hzid,t.itemcode,t.itemname,to_number(t.itemvalue) xuetang ,to_date(t.temp5,'yyyy-mm-dd') writedate, h.hzname,h.sex,h.sfzcode,h.mz from s_tnb_tnbson t , s_hzxx h
where t.hzid = h.id 
and t.itemcode like '015%'
and h.sfzcode in ('131002198504113228','130223198702267510','371481200812250920','230603201008281325','150622201201110017','130727198704072429',
'410322201107190134','141123200809170011','140202200806090027','110224198403205524','110111200405318612','420222198302016467','210903201404180019',
'110105201307254624','110106201403087260','110104200902163013','130626198708257120','410305198304044020','140105201309300052','130628200702240362',
'110106197910261826','130721200712194639','150621201210240011','371425200106194625','130681200901112023','372831197809267929','130731198701192825',
'130225200504190017','130582198510232088','410923201106160266','130726199005293327','130982200206100912','371526198512055219','140602198209061537',
'130702200410060020','150304201202122520','130634200709283346','110102200904172340','152627197601074929','330381200310273336','410505200906270034',
'110222197901136121','320902198410121028','130921198203114822','130684200504165470','130681198405234110','110115200111090312','130681197606081240',
'150822200708170023','130926200502262819')
order by h.sfzcode , writedate ) tt 
group by tt.sfzcode, tt.writedate 
order by tt.sfzcode